# AI Listener

AI Listener is a Spring Boot Application designed to enhance documents stored in an Alfresco Repository. It performs the following tasks:

1. Listens to Alfresco Repository messages to capture the setting of `genai:summarizable` on a node.
2. Converts the content to PDF format: ensures that the content is in PDF format for further processing.
3. Utilizes the Gen AI service to generate summaries, tags, and language model (LLM) information.
4. Updates the Alfresco Repository with the obtained summary, tags, and LLM for each document.

Additionally, captures the change of the property `genai:question` to produce an answer generated by the Gen AI service.

## Configuration

File [application.properties](src/main/resources/application.properties) includes configuration to connect with Alfresco Repository, to define the content model, to connect with ActiveMQ Server and GenAI endpoint. These parameters can be used also as command line arguments.

```
# Spring Boot properties
spring.main.banner-mode=off
logging.level.org.springframework=ERROR
logging.level.org.alfresco=INFO
logging.pattern.console=%msg%n

# Alfresco Server Configuration
# Basic authentication credentials for Alfresco Server
content.service.security.basicAuth.username=admin
content.service.security.basicAuth.password=admin
# URL and path for Alfresco Server API
content.service.url=http://localhost:8080
content.service.path=/alfresco/api/-default-/public/alfresco/versions/1


# Alfresco Repository Content Model (Summary)
# Aspect that triggers the summarization task
content.service.summary.aspect=genai:summarizable
# Node property to store the summary obtained from GenAI Stack
content.service.summary.summary.property=genai:summary
# Node property to store tags obtained from GenAI Stack; use TAG as a value to use a tag instead of a property
content.service.summary.tags.property=genai:tags
# Node property to store the Large Language Model (LLM) used; use TAG as a value to use a tag instead of a property
content.service.summary.model.property=genai:model

# Alfresco Repository Content Model (Prompt)
# Aspect that enables prompt task
content.service.prompt.aspect=genai:promptable
# Node property that contains a question
content.service.prompt.question.property=genai:question
# Node property to fill with the answer
content.service.prompt.answer.property=genai:answer
# Node property to fill with the model
content.service.prompt.model.property=genai:llm

# ActiveMQ Server
spring.activemq.brokerUrl=tcp://localhost:61616
spring.jms.cache.enabled=false
alfresco.events.enableSpringIntegration=false
alfresco.events.enableHandlers=true

# GenAI Client Configuration
# Host URL for the Document GenAI service
genai.url=http://localhost:8506
# Request timeout in seconds for GenAI service requests
genai.request.timeout=1200
```

## Building

To build the AI Listener, use the default Maven command:

```bash
mvn clean package
```

## Running

Execute the program from the command line:

```bash
$ java -jar target/alfresco-ai-listener-0.8.0.jar
Started AiListenerApplication in 1.876 seconds (process running for 2.123)
PDF Rendition has been requested for document b20efa32-c368-4125-ab5f-feb4d5c56975
Summarizing document b20efa32-c368-4125-ab5f-feb4d5c56975
Document b20efa32-c368-4125-ab5f-feb4d5c56975 has been updated with summary and tag
```

The application will run indefinitely; stop the program using `Ctrl+C`

## Using the Docker Image

Docker Image can be built to be used in Docker Compose:

```yaml
    alfresco-ai-listener:
        image: alfresco-ai-listener
        environment:
            CONTENT_SERVICE_URL: "http://alfresco:8080"
            SPRING_ACTIVEMQ_BROKERURL: "tcp://activemq:61616"
            GENAI_URL: "http://genai:8506"
        depends_on:
            - alfresco
```